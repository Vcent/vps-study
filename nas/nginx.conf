server {
    # 保留你原有的监听配置（容器内 80 端口，无域名）
    listen 80;
    server_name _;

    # 保留你原有的全局配置（大文件上传+安全响应头）
    client_max_body_size 20M;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Permissions-Policy "accelerometer=(), ambient-light-sensor=(), battery=(), bluetooth=(), camera=(), clipboard-read=(), display-capture=(), document-domain=(), encrypted-media=(), gamepad=(), geolocation=(), gyroscope=(), hid=(), idle-detection=(), interest-cohort=(), keyboard-map=(), local-fonts=(), magnetometer=(), microphone=(), payment=(), publickey-credentials-get=(), serial=(), sync-xhr=(), usb=(), xr-spatial-tracking=()" always;

    # 保留你原有的 Stash 配置：root /var/www + index index.html
    root /var/www;
    index index.html;

    ###########################################################################
    # 保留你原有的 Jellyfin 代理配置（无任何修改）
    ###########################################################################
    location /jellyfin1/ {
        proxy_pass http://192.168.1.201:8097/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /jellyfin1;
        proxy_buffering off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 600s;
    }
    location /jellyfin2/ {
        proxy_pass http://192.168.1.25:8096/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /jellyfin2;
        proxy_buffering off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 600s;
    }

    ###########################################################################
    # 保留你原有的 Stash 代理配置（无任何修改）
    ###########################################################################
    location /stash2/ {
        proxy_pass http://192.168.1.25:9999/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /stash2;
        proxy_read_timeout 60000s;
    }
    location /stash1/ {
        proxy_pass http://192.168.1.201:9999/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /stash1;
        proxy_read_timeout 60000s;
    }

    location ^~ /wrt/ {
        proxy_pass http://192.168.1.211/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /wrt;
        proxy_read_timeout 60000s;
    }

    location ^~ /cgi-bin/luci/ {
        proxy_pass http://192.168.1.211$request_uri;  # 保留完整路径转发
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 60000s;
    }

    location ^~ /luci-static/ {
        proxy_pass http://192.168.1.211$request_uri;  # 保留完整路径转发
        proxy_http_version 1.1;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_read_timeout 60000s;
    }

    ###########################################################################
    # 兼容无 / 访问（可选，不影响原有功能）
    ###########################################################################
    location = /jellyfin1 {
        return 301 $scheme://$host/jellyfin1/;
    }
    location = /stash2 {
        return 301 $scheme://$host/stash2/;
    }
    location = /jellyfin2 {
        return 301 $scheme://$host/jellyfin2/;
    }
    location = /stash1 {
        return 301 $scheme://$host/stash1/;
    }
    location = /wrt {
        return 301 $scheme://$host/wrt/;
    }

    ###########################################################################
    # 兜底：保留你原有的 404 提示逻辑
    ###########################################################################
    location / {
        # 若访问根路径，优先返回 404（避免加载 /var/www/index.html）
        # 若你需要根路径访问静态文件，可删除这行，保留默认的 index.html 查找
        #return 404 "Service only available.";
    }
}

